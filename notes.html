<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Asianloop Sticky Notes</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen font-sans">
  <div class="max-w-3xl mx-auto px-4 py-6">

    <!-- Header -->
    <div class="bg-white text-slate-900 rounded-2xl shadow-md p-4 sm:p-6">
      <div class="flex flex-col items-center sm:flex-row sm:justify-between gap-4">
        <!-- Logo + Title -->
        <div class="flex flex-col items-center sm:flex-row sm:items-center gap-3 text-center sm:text-left">
          <div class="bg-white rounded-xl shadow p-2">
            <img src="logo.jpg" alt="Asianloop Logo" class="h-10 w-auto" />
          </div>
          <div>
            <h1 class="text-xl sm:text-2xl font-bold">Asianloop Sticky Notes</h1>
            <p class="text-xs sm:text-sm text-slate-600">Fast notes ‚Ä¢ Autosave ‚Ä¢ Export/Import</p>
          </div>
        </div>

        <!-- Buttons -->
        <div class="grid grid-cols-2 sm:flex gap-2 w-full sm:w-auto">
          <button id="newNoteBtn" class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white text-sm">+ New</button>
          <button id="exportBtn" class="px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm">Export TXT</button>
          <label class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-white text-sm cursor-pointer text-center">
            Import JSON <input id="importInput" type="file" accept="application/json" class="hidden">
          </label>
          <button id="clearAllBtn" class="px-3 py-2 rounded-lg bg-rose-600 hover:bg-rose-700 text-white text-sm">Clear</button>
        </div>
      </div>

      <!-- Filters -->
      <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
        <input id="searchInput" placeholder="Search notes‚Ä¶" class="col-span-2 w-full px-3 py-2 rounded-lg bg-slate-100 outline-none ring-1 ring-slate-300 focus:ring-indigo-500 text-sm" />
        <input id="tagInput" placeholder="#tag filter" class="w-full px-3 py-2 rounded-lg bg-slate-100 outline-none ring-1 ring-slate-300 focus:ring-indigo-500 text-sm" />
      </div>

      <!-- Privacy note -->
      <p class="mt-3 text-[11px] text-slate-500 text-center sm:text-right">
        üîí Notes are stored locally in your browser. Your data never leaves this device.
      </p>
    </div>

    <!-- Notes Grid -->
    <div id="notesGrid" class="mt-6 grid gap-4 grid-cols-1 sm:grid-cols-2"></div>

    <!-- Empty -->
    <div id="emptyState" class="mt-16 text-center text-slate-400 hidden">
      <p class="text-2xl">üóíÔ∏è No matching notes</p>
      <p class="mt-1 text-sm">Try clearing the search or tag filter.</p>
    </div>
  </div>

  <!-- Template -->
  <template id="noteTpl">
    <div class="note bg-slate-800 rounded-xl p-3 ring-1 ring-slate-700">
      <div class="flex items-center justify-between mb-2">
        <input class="title flex-1 bg-transparent outline-none text-sm font-medium placeholder-slate-400" placeholder="Untitled note" />
        <div class="flex gap-2 ml-2">
          <button class="pin px-2 py-1 text-xs rounded bg-amber-600 text-white">Pin</button>
          <button class="del px-2 py-1 text-xs rounded bg-rose-600 text-white">Delete</button>
        </div>
      </div>
      <textarea class="body w-full h-24 bg-transparent outline-none text-sm placeholder-slate-400" placeholder="Write something‚Ä¶"></textarea>
      <div class="flex justify-between items-center mt-2">
        <input class="tags flex-1 bg-slate-900/50 rounded px-2 py-1 text-xs outline-none placeholder-slate-500" placeholder="#tags" />
        <span class="updated text-[11px] text-slate-400 ml-2"></span>
      </div>
    </div>
  </template>

  <script>
    const STORAGE_KEY = 'sticky_notes_v1';
    /** @type {Array<{title:string,body:string,tags:string[],pinned:boolean,updated:number}>} */
    let notes = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

    const grid = document.getElementById('notesGrid');
    const tpl = document.getElementById('noteTpl');
    const empty = document.getElementById('emptyState');
    const searchInput = document.getElementById('searchInput');
    const tagInput = document.getElementById('tagInput');

    // helpers
    const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
    const sorter = (a, b) => (a.pinned === b.pinned ? b.updated - a.updated : a.pinned ? -1 : 1);

    function matchesFilters(n) {
      const q = searchInput.value.trim().toLowerCase();
      const tag = tagInput.value.trim().toLowerCase().replace(/^#/, '');
      const qok = !q
        || (n.title || '').toLowerCase().includes(q)
        || (n.body || '').toLowerCase().includes(q)
        || (n.tags || []).join(' ').toLowerCase().includes(q);
      const tok = !tag || (n.tags || []).map(t => t.toLowerCase()).includes(tag);
      return qok && tok;
    }

    function render(){
      grid.innerHTML = "";
      const filtered = notes.filter(matchesFilters).sort(sorter);
      empty.classList.toggle("hidden", filtered.length > 0);

      filtered.forEach((n,i)=>{
        const node = tpl.content.cloneNode(true);
        const title = node.querySelector(".title");
        const body = node.querySelector(".body");
        const tags = node.querySelector(".tags");
        const updated = node.querySelector(".updated");
        const del = node.querySelector(".del");
        const pin = node.querySelector(".pin");

        title.value = n.title || "";
        body.value = n.body || "";
        tags.value = (n.tags || []).join(", ");
        updated.textContent = new Date(n.updated || Date.now()).toLocaleString();

        const onChange=()=>{
          n.title=title.value;
          n.body=body.value;
          n.tags=tags.value.split(/[,\s]+/).map(s=>s.trim()).filter(Boolean);
          n.updated=Date.now();
          save();
          updated.textContent=new Date(n.updated).toLocaleString();
        };
        title.addEventListener("input", onChange);
        body.addEventListener("input", onChange);
        tags.addEventListener("input", onChange);

        del.addEventListener("click",()=>{
          const idx = notes.indexOf(n);
          if (idx > -1) { notes.splice(idx,1); save(); render(); }
        });
        pin.textContent = n.pinned ? "Unpin" : "Pin";
        pin.addEventListener("click",()=>{
          n.pinned=!n.pinned; n.updated=Date.now(); save(); render();
        });

        grid.appendChild(node);
      });
    }

    document.getElementById("newNoteBtn").addEventListener("click",()=>{
      notes.unshift({title:"",body:"",tags:[],pinned:false,updated:Date.now()});
      save(); render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Export as TXT
    document.getElementById("exportBtn").addEventListener("click",()=>{
      let txt = "";
      const data = notes.slice().sort(sorter);
      data.forEach((n,i)=>{
        txt += `=== Note ${i+1} ===\n`;
        txt += `Title: ${n.title || "(untitled)"}\n`;
        txt += `Body:\n${n.body || ""}\n`;
        txt += `Tags: ${(n.tags||[]).join(", ")}\n`;
        txt += `Pinned: ${n.pinned ? "Yes" : "No"}\n`;
        txt += `Updated: ${new Date(n.updated).toLocaleString()}\n\n`;
      });
      const blob=new Blob([txt],{type:"text/plain"});
      const a=document.createElement("a");
      a.href=URL.createObjectURL(blob);
      a.download="notes.txt";
      a.click();
      URL.revokeObjectURL(a.href);
    });

    // Import JSON (structured backup)
    document.getElementById("importInput").addEventListener("change",e=>{
      const file=e.target.files[0]; if(!file)return;
      const r=new FileReader();
      r.onload=()=>{
        try{
          const arr = JSON.parse(r.result);
          if (!Array.isArray(arr)) throw new Error();
          // normalize
          notes = arr.map(n=>({
            title: String(n.title||""),
            body: String(n.body||""),
            tags: Array.isArray(n.tags) ? n.tags.map(String) : [],
            pinned: Boolean(n.pinned),
            updated: Number(n.updated||Date.now())
          }));
          save(); render();
        }catch{ alert("Invalid JSON backup"); }
      };
      r.readAsText(file);
      e.target.value = "";
    });

    document.getElementById("clearAllBtn").addEventListener("click",()=>{
      if(confirm("Delete all notes?")){
        notes=[]; save(); render();
      }
    });

    // Wire up live filtering
    searchInput.addEventListener("input", render);
    tagInput.addEventListener("input", render);

    // initial paint
    render();
  </script>
</body>
</html>
